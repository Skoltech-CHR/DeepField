

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>deepfield.field.field &mdash; DeepField  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> DeepField
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/deepfield.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DeepField</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>deepfield.field.field</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for deepfield.field.field</h1><div class="highlight"><pre>
<span></span><span class="c1"># pylint: disable=too-many-lines</span>
<span class="sd">&quot;&quot;&quot;Field class.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">Template</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">pyvista</span> <span class="k">as</span> <span class="nn">pv</span>
<span class="kn">from</span> <span class="nn">anytree</span> <span class="k">import</span> <span class="n">PreOrderIter</span>
<span class="kn">from</span> <span class="nn">deprecated.sphinx</span> <span class="k">import</span> <span class="n">deprecated</span>

<span class="kn">from</span> <span class="nn">.base_spatial</span> <span class="k">import</span> <span class="n">SpatialComponent</span>
<span class="kn">from</span> <span class="nn">.grids</span> <span class="k">import</span> <span class="n">OrthogonalUniformGrid</span><span class="p">,</span> <span class="n">CornerPointGrid</span><span class="p">,</span> <span class="n">Grid</span>
<span class="kn">from</span> <span class="nn">.rock</span> <span class="k">import</span> <span class="n">Rock</span>
<span class="kn">from</span> <span class="nn">.states</span> <span class="k">import</span> <span class="n">States</span>
<span class="kn">from</span> <span class="nn">.aquifer</span> <span class="k">import</span> <span class="n">Aquifers</span>
<span class="kn">from</span> <span class="nn">.wells</span> <span class="k">import</span> <span class="n">Wells</span>
<span class="kn">from</span> <span class="nn">.tables</span> <span class="k">import</span> <span class="n">Tables</span>
<span class="kn">from</span> <span class="nn">.rates</span> <span class="k">import</span> <span class="n">calc_rates</span><span class="p">,</span> <span class="n">calc_rates_multiprocess</span>

<span class="kn">from</span> <span class="nn">.decorators</span> <span class="k">import</span> <span class="n">state_check</span><span class="p">,</span> <span class="n">cached_property</span>
<span class="kn">from</span> <span class="nn">.parse_utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">tnav_ascii_parser</span><span class="p">,</span> <span class="n">preprocess_path</span><span class="p">,</span>
                          <span class="n">dates_to_str</span><span class="p">,</span> <span class="n">read_dates_from_buffer</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.plot_utils</span> <span class="k">import</span> <span class="n">lines_from_points</span>

<span class="kn">from</span> <span class="nn">.template_models</span> <span class="k">import</span> <span class="p">(</span><span class="n">ORTHOGONAL_GRID</span><span class="p">,</span> <span class="n">CORNERPOINT_GRID</span><span class="p">,</span>
                              <span class="n">DEFAULT_TN_MODEL</span><span class="p">,</span> <span class="n">DEFAULT_ECL_MODEL</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">get_single_path</span><span class="p">,</span> <span class="n">get_well_mask</span><span class="p">,</span> <span class="n">get_spatial_well_control</span><span class="p">,</span> <span class="n">get_spatial_cf_and_perf</span>
<span class="kn">from</span> <span class="nn">.configs</span> <span class="k">import</span> <span class="n">default_config</span>
<span class="kn">from</span> <span class="nn">.dump_ecl_utils</span> <span class="k">import</span> <span class="n">egrid</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">restart</span><span class="p">,</span> <span class="n">summary</span>

<span class="n">ACTOR</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">COMPONENTS_DICT</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cornerpointgrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="n">CornerPointGrid</span><span class="p">],</span>
                   <span class="s1">&#39;orthogonaluniformgrid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">],</span>
                   <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="n">Grid</span><span class="p">],</span>
                   <span class="s1">&#39;rock&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rock&#39;</span><span class="p">,</span> <span class="n">Rock</span><span class="p">],</span>
                   <span class="s1">&#39;states&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">,</span> <span class="n">States</span><span class="p">],</span>
                   <span class="s1">&#39;wells&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;wells&#39;</span><span class="p">,</span> <span class="n">Wells</span><span class="p">],</span>
                   <span class="s1">&#39;tables&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">,</span> <span class="n">Tables</span><span class="p">],</span>
                   <span class="s1">&#39;aquifers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;aquifers&#39;</span><span class="p">,</span> <span class="n">Aquifers</span><span class="p">]</span>
                   <span class="p">}</span>

<span class="n">DEFAULT_HUNITS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;METRIC&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sm3/day&#39;</span><span class="p">,</span> <span class="s1">&#39;ksm3/day&#39;</span><span class="p">,</span> <span class="s1">&#39;ksm3&#39;</span><span class="p">,</span> <span class="s1">&#39;Msm3&#39;</span><span class="p">,</span> <span class="s1">&#39;bara&#39;</span><span class="p">],</span>
                  <span class="s1">&#39;FIELD&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;stb/day&#39;</span><span class="p">,</span> <span class="s1">&#39;Mscf/day&#39;</span><span class="p">,</span> <span class="s1">&#39;Mstb&#39;</span><span class="p">,</span> <span class="s1">&#39;MMscf&#39;</span><span class="p">,</span> <span class="s1">&#39;psia&#39;</span><span class="p">]}</span>

<span class="c1">#pylint: disable=protected-access</span>
<span class="k">class</span> <span class="nc">FieldState</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;State holder.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_field</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference Field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_field</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spatial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Common state of spatial components.&quot;&quot;&quot;</span>
        <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">comp</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">spatial</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                           <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">SpatialComponent</span><span class="p">)])</span>
        <span class="k">if</span> <span class="s1">&#39;wells&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">states</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">spatial</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">states</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">~</span><span class="n">states</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Spatial components have different states.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Field"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field">[docs]</a><span class="k">class</span> <span class="nc">Field</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Reservoir model.</span>

<span class="sd">    Contains components of reservoir model and preprocessing actions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str, optional</span>
<span class="sd">        Path to source model files.</span>
<span class="sd">    config : dict, optional</span>
<span class="sd">        Components and attributes to load.</span>
<span class="sd">    logfile : str, optional</span>
<span class="sd">        Path to log file.</span>
<span class="sd">    enoding : str, optional</span>
<span class="sd">        Files encoding. Set &#39;auto&#39; to infer encoding from initial file block.</span>
<span class="sd">        Sometimes it might help to specify block size, e.g. &#39;auto:3000&#39; will</span>
<span class="sd">        read first 3000 bytes to infer encoding.</span>
<span class="sd">    loglevel : str, optional</span>
<span class="sd">            Log level to be printed while loading. Default to &#39;INFO&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">preprocess_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;UNITS&#39;</span><span class="p">:</span> <span class="s1">&#39;METRIC&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;DATES&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([]),</span>
                      <span class="s1">&#39;FLUIDS&#39;</span><span class="p">:</span> <span class="p">[],</span>
                      <span class="s1">&#39;HUNITS&#39;</span><span class="p">:</span> <span class="n">DEFAULT_HUNITS</span><span class="p">[</span><span class="s1">&#39;METRIC&#39;</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">FieldState</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">handlers</span><span class="o">=</span><span class="n">handlers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;Field&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">loglevel</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_components</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;use_only_active&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;cell_size&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;scaling&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_init_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize components.&quot;&quot;&quot;</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_parser</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;HDF5&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{}}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
                <span class="k">elif</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;cornerpointgrid&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;cornerpointgrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s1">&#39;orthogonaluniformgrid&#39;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                        <span class="n">config</span><span class="p">[</span><span class="s1">&#39;orthogonaluniformgrid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Using default config.&#39;</span><span class="p">)</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_parser</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">default_config</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="p">{</span><span class="n">COMPONENTS_DICT</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">COMPONENTS_DICT</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">config</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">COMPONENTS_DICT</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_config_parser</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Separate config into attrs and kwargs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;attrs&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">attrs</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;attrs&#39;</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Component&#39;s config should be of type str, list, tuple or dict. Found </span><span class="si">{}</span><span class="s2">.&quot;</span>
                            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="n">attrs</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">}</span>

<div class="viewcode-block" id="Field.assert_components_available"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.assert_components_available">[docs]</a>    <span class="k">def</span> <span class="nf">assert_components_available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">comp_names</span><span class="p">):</span>
        <span class="c1"># FIXME add to all the methods where required</span>
        <span class="sd">&quot;&quot;&quot;Raises ValueError in case comp_names are not presented in self.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">comp_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Component </span><span class="si">%s</span><span class="s1"> is not loaded!&#39;</span> <span class="o">%</span> <span class="n">comp</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">meta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Model meta data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Field state.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model start time in a datetime format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Path to original model.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Model has no file to originate from.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model filename without extention.&quot;&quot;&quot;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model components.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<div class="viewcode-block" id="Field.items"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns pairs of components&#39;s names and instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Grid component.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>

    <span class="nd">@grid</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Grid component setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wells component.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;wells&#39;</span><span class="p">]</span>

    <span class="nd">@wells</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">wells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wells component setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;wells&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rock component.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;rock&#39;</span><span class="p">]</span>

    <span class="nd">@rock</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rock component setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;rock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;States component.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">]</span>

    <span class="nd">@states</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;States component setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aquifers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Aquifers component.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;aquifers&#39;</span><span class="p">]</span>

    <span class="nd">@aquifers</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">aquifers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;States component setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;aquifers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tables component.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">]</span>

    <span class="nd">@tables</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tables component setter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="s1">&#39;tables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Field.get_spatial_connection_factors_and_perforation_ratio"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.get_spatial_connection_factors_and_perforation_ratio">[docs]</a>    <span class="k">def</span> <span class="nf">get_spatial_connection_factors_and_perforation_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get model&#39;s connection factors and perforation ratios in a spatial form.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        date_range: tuple</span>
<span class="sd">            Minimal and maximal dates for events.</span>
<span class="sd">        mode: str, None</span>
<span class="sd">            If not None, pick the blocks only with specified mode.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        connection_factors: np.array</span>
<span class="sd">        perf_ratio: np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_spatial_cf_and_perf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="n">date_range</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">result_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Result dates, actual if present, target otherwise.&quot;&quot;&quot;</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">result_dates</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dates</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dates</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">event_dates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">dates</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>

    <span class="nd">@cached_property</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">spatial</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">x</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">well_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the model&#39;s well mask in a spatial form.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        well_mask: np.array</span>
<span class="sd">            Array with well-names in cells which are registered as well-blocks and empty strings everywhere else.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_well_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Field.get_spatial_well_control"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.get_spatial_well_control">[docs]</a>    <span class="k">def</span> <span class="nf">get_spatial_well_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_shut</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fill_outside</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the model&#39;s control in a spatial form</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attrs: tuple or list</span>
<span class="sd">            Conrol attributes to get data from.</span>
<span class="sd">        date_range: tuple</span>
<span class="sd">            Minimal and maximal dates for control events.</span>
<span class="sd">        fill_shut: float</span>
<span class="sd">            Value to fill shutted perforations</span>
<span class="sd">        fill_outside:</span>
<span class="sd">            Value to fill non-perforated cells</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        control: np.array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_spatial_well_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">date_range</span><span class="o">=</span><span class="n">date_range</span><span class="p">,</span>
                                        <span class="n">fill_shut</span><span class="o">=</span><span class="n">fill_shut</span><span class="p">,</span> <span class="n">fill_outside</span><span class="o">=</span><span class="n">fill_outside</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field.set_state"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.set_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;State setter.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Field.copy"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deepcopy of Field.&quot;&quot;&quot;</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span> <span class="c1">#pylint: disable=protected-access</span>
        <span class="k">return</span> <span class="n">copy</span></div>

<div class="viewcode-block" id="Field.load"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">spatial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load model components.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        raise_errors : bool</span>
<span class="sd">            Error handling mode. If True, errors will be raised and stop loading.</span>
<span class="sd">            If False, errors will be printed but do not stop loading.</span>
<span class="sd">        include_binary : bool</span>
<span class="sd">            Read data from binary files in RESULTS folder. Default to True.</span>
<span class="sd">        spatial : bool</span>
<span class="sd">            Return Field components is spatial state.</span>
<span class="sd">        fill_na: float</span>
<span class="sd">            Value to fill at non-active cells. Default to 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : Field</span>
<span class="sd">            Field with loaded components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;HDF5&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_hdf5</span><span class="p">(</span><span class="n">raise_errors</span><span class="o">=</span><span class="n">raise_errors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DATA&#39;</span><span class="p">,</span> <span class="s1">&#39;DAT&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">(</span><span class="n">raise_errors</span><span class="o">=</span><span class="n">raise_errors</span><span class="p">,</span> <span class="n">include_binary</span><span class="o">=</span><span class="n">include_binary</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Format </span><span class="si">{}</span><span class="s1"> is not supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="p">(</span><span class="n">CornerPointGrid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;ZCORN&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;COORD&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">CornerPointGrid</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">OrthogonalUniformGrid</span><span class="p">(</span><span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="k">if</span> <span class="s1">&#39;ACTNUM&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">and</span> <span class="s1">&#39;DIMENS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="o">.</span><span class="n">prod</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">SpatialComponent</span><span class="p">):</span>
                <span class="n">k</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">spatial</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">loaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_loaded_attrs</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;WELLS&#39;</span> <span class="ow">in</span> <span class="n">loaded</span> <span class="ow">and</span> <span class="s1">&#39;COMPDAT&#39;</span> <span class="ow">in</span> <span class="n">loaded</span><span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;MODEL_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ECL&#39;</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;COMPDAT&#39;</span><span class="p">,</span> <span class="s1">&#39;WCONPROD&#39;</span><span class="p">,</span> <span class="s1">&#39;WCONINJE&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;DATE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;DATE&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;GRID&#39;</span> <span class="ow">in</span> <span class="n">loaded</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">add_welltrack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;MODEL_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;TN&#39;</span>

        <span class="k">if</span> <span class="n">spatial</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_spatial</span><span class="p">(</span><span class="n">fill_na</span><span class="o">=</span><span class="n">fill_na</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">CornerPointGrid</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">map_grid</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s1">&#39;Grid pillars (`COORD`) are mapped to new axis &#39;</span><span class="p">,</span>
                             <span class="s1">&#39;with respect to `MAPAXES`.&#39;</span><span class="p">)))</span>

        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Field.to_spatial"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.to_spatial">[docs]</a>    <span class="k">def</span> <span class="nf">to_spatial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bring data to spatial state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fill_na: float</span>
<span class="sd">            Value to fill at non-active cells. Default to 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: Field</span>
<span class="sd">            Field in spatial representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">to_spatial</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;rock&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ACTNUM&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">pad_na</span><span class="p">(</span><span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">fill_na</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">to_spatial</span><span class="p">(</span><span class="n">dimens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;states&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;ACTNUM&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">pad_na</span><span class="p">(</span><span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">fill_na</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">to_spatial</span><span class="p">(</span><span class="n">dimens</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;wells&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">has_blocks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">blocks_to_spatial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Field.unravel"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.unravel">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Renamed to_spatial&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unravel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Alias for `to_spatial` method.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_spatial</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Field.ravel"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.ravel">[docs]</a>    <span class="k">def</span> <span class="nf">ravel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ravel data in spatial components.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        only_active : bool</span>
<span class="sd">            Strip non-active cells fron state vectors. Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out: Field</span>
<span class="sd">            Field with reshaped spatial components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;grid&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;rock&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">only_active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;states&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">only_active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;wells&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">has_blocks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">blocks_ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_load_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_errors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load model in HDF5 format.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;DATES&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">comp</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                                     <span class="n">attrs</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;attrs&#39;</span><span class="p">],</span>
                                     <span class="n">raise_errors</span><span class="o">=</span><span class="n">raise_errors</span><span class="p">,</span>
                                     <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_load_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_errors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load data from binary files in RESULTS folder.&quot;&quot;&quot;</span>
        <span class="n">path_to_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="s1">&#39;RESULTS&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_results</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">raise_errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;RESULTS folder was not found in model directory.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;RESULTS folder was not found in model directory.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;states&#39;</span><span class="p">,</span> <span class="s1">&#39;rock&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s1">&#39;wells&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path_to_results</span><span class="p">,</span>
                                         <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;attrs&#39;</span><span class="p">],</span>
                                         <span class="n">basename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span>
                                         <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
                                         <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load model in DATA format.&quot;&quot;&quot;</span>
        <span class="n">loaders</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ARRA&#39;</span><span class="p">,</span> <span class="s1">&#39;ARRAY&#39;</span><span class="p">,</span> <span class="s1">&#39;DATES&#39;</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;START&#39;</span><span class="p">,</span> <span class="s1">&#39;METRIC&#39;</span><span class="p">,</span> <span class="s1">&#39;FIELD&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;HUNI&#39;</span><span class="p">,</span> <span class="s1">&#39;HUNITS&#39;</span><span class="p">,</span> <span class="s1">&#39;OIL&#39;</span><span class="p">,</span> <span class="s1">&#39;GAS&#39;</span><span class="p">,</span> <span class="s1">&#39;WATER&#39;</span><span class="p">,</span> <span class="s1">&#39;DISGAS&#39;</span><span class="p">,</span> <span class="s1">&#39;VAPOIL&#39;</span><span class="p">]:</span>
            <span class="n">loaders</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_buffer</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">include_binary</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_binary</span><span class="p">(</span><span class="n">raise_errors</span><span class="o">=</span><span class="n">raise_errors</span><span class="p">)</span>

        <span class="n">rsm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">comp</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;attrs&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;attrs&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span><span class="p">))</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="s1">&#39;rock&#39;</span><span class="p">,</span> <span class="s1">&#39;states&#39;</span><span class="p">,</span> <span class="s1">&#39;tables&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                    <span class="n">loaders</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
                                         <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s1">&#39;wells&#39;</span><span class="p">:</span>
                <span class="n">extented_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PERF&#39;</span><span class="p">,</span> <span class="s1">&#39;EVENTS&#39;</span><span class="p">]:</span>
                        <span class="n">extented_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;EFIL&#39;</span><span class="p">,</span> <span class="s1">&#39;EFILE&#39;</span><span class="p">,</span> <span class="s1">&#39;ETAB&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;HISTORY&#39;</span><span class="p">:</span>
                        <span class="n">extented_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;HFIL&#39;</span><span class="p">,</span> <span class="s1">&#39;HFILE&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;WELLTRACK&#39;</span><span class="p">:</span>
                        <span class="n">extented_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;TFIL&#39;</span><span class="p">,</span> <span class="s1">&#39;WELLTRACK&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;RESULTS&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">extented_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                    <span class="n">extented_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;GROU&#39;</span><span class="p">,</span> <span class="s1">&#39;GROUP&#39;</span><span class="p">,</span> <span class="s1">&#39;GRUPTREE&#39;</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">extented_list</span><span class="p">):</span>
                    <span class="n">loaders</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
                                         <span class="n">meta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

                <span class="k">if</span> <span class="s1">&#39;RESULTS&#39;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                    <span class="n">path_to_results</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="s1">&#39;RESULTS&#39;</span><span class="p">)</span>
                    <span class="n">rsm</span> <span class="o">=</span> <span class="n">get_single_path</span><span class="p">(</span><span class="n">path_to_results</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.RSM&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rsm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">include_binary</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">raise_errors</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;RSM file was not found in model directory.&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;RSM file was not found in model directory.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s1">&#39;aquifers&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;AQCT&#39;</span><span class="p">,</span> <span class="s1">&#39;AQCO&#39;</span><span class="p">,</span> <span class="s1">&#39;AQUANCON&#39;</span><span class="p">,</span> <span class="s1">&#39;AQUCT&#39;</span><span class="p">]:</span>
                    <span class="n">loaders</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aquifers</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="n">tnav_ascii_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">loaders</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">,</span>
                          <span class="n">raise_errors</span><span class="o">=</span><span class="n">raise_errors</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rsm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rsm</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;VAPOIL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;FLUIDS&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;tables&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">:</span>
            <span class="c1"># TODO should we make a kwarg for convertion key?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">pvtg_to_pvdg</span><span class="p">(</span><span class="n">as_saturated</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;FLUIDS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;VAPOIL&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Vaporized oil option is not currently supported.</span>
<span class="sd">                PVTG table will be converted into PVDG one.&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_read_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load model meta attributes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;START&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t\n\&#39;\&quot;</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s1">&#39;DATES&#39;</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ARRA&#39;</span><span class="p">,</span> <span class="s1">&#39;ARRAY&#39;</span><span class="p">]:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">read_dates_from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;METRIC&#39;</span><span class="p">,</span> <span class="s1">&#39;FIELD&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;UNITS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;HUNI&#39;</span><span class="p">,</span> <span class="s1">&#39;HUNITS&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_hunits</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OIL&#39;</span><span class="p">,</span> <span class="s1">&#39;GAS&#39;</span><span class="p">,</span> <span class="s1">&#39;WATER&#39;</span><span class="p">,</span> <span class="s1">&#39;DISGAS&#39;</span><span class="p">,</span> <span class="s1">&#39;VAPOIL&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;FLUIDS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Keyword </span><span class="si">{}</span><span class="s2"> is not supported.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_read_hunits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse HUNIts from line.&quot;&quot;&quot;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/</span><span class="se">\t\n</span><span class="s1"> &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;HUNITS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">DEFAULT_HUNITS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;UNITS&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">nread</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;HUNITS&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;HUNITS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">defaults</span><span class="p">[</span><span class="n">nread</span><span class="p">:</span> <span class="n">nread</span> <span class="o">+</span> <span class="n">n</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;HUNITS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;HUNITS&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaults</span><span class="p">),</span> <span class="s1">&#39;Missmatch of HUNITS array length&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_check_loaded_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Collect loaded attributes and fill defaults for missing ones.&quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;===== Field summary =====&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;START&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1 JAN 1973&#39;</span> <span class="c1">#default ECLIPSE/tNavigator start date</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Missed start date, set default 1 JAN 1973.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;FLUIDS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="p">[</span><span class="s1">&#39;FLUIDS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OIL&#39;</span><span class="p">,</span> <span class="s1">&#39;GAS&#39;</span><span class="p">,</span> <span class="s1">&#39;WATER&#39;</span><span class="p">,</span> <span class="s1">&#39;DISGAS&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;FLUIDS are not found, set default [&#39;OIL&#39;, &#39;GAS&#39;, &#39;WATER&#39;, &#39;DISGAS&#39;].&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">dates</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Start date and DATES are not monotone.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s1">&#39;wells&#39;</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">PreOrderIter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">root</span><span class="p">):</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attributes</span><span class="p">))</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">comp</span> <span class="o">==</span> <span class="s1">&#39;aquifers&#39;</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">aqf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aquifers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">aqf</span><span class="o">.</span><span class="n">attributes</span><span class="p">))</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">attributes</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> attributes: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attrs</span><span class="p">))</span>
            <span class="n">out</span><span class="p">[</span><span class="n">comp</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="n">attrs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;=========================&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="Field.dump"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dump model components.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Common path for output files. If None path will be inherited from model path.</span>
<span class="sd">        mode : str</span>
<span class="sd">            Mode to open file.</span>
<span class="sd">            &#39;w&#39;: write, a new file is created (an existing file with</span>
<span class="sd">            the same name would be deleted).</span>
<span class="sd">            &#39;a&#39;: append, an existing file is opened for reading and writing,</span>
<span class="sd">            and if the file does not exist it is created.</span>
<span class="sd">            Default to &#39;a&#39;.</span>
<span class="sd">        data : bool</span>
<span class="sd">            Dump initial model data. No effect for HDF5 output. Default True.</span>
<span class="sd">        results : bool</span>
<span class="sd">            Dump calculated results. No effect for HDF5 output. Default True.</span>
<span class="sd">        title : str</span>
<span class="sd">            Model name. No effect for HDF5 output.</span>
<span class="sd">        kwargs : misc</span>
<span class="sd">            Any additional named arguments to ``dump``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : Field</span>
<span class="sd">            Field unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;Untitled&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dump_binary_results</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;HDF5&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dump_hdf5</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dump_ascii</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">result_dates</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dump_binary_results</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Format </span><span class="si">{}</span><span class="s1"> is not supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="k">def</span> <span class="nf">_dump_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">only_active</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reduce_floats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dump model into HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to output file.</span>
<span class="sd">        mode : str</span>
<span class="sd">            Mode to open file.</span>
<span class="sd">            &#39;w&#39;: write, a new file is created (an existing file with</span>
<span class="sd">            the same name would be deleted).</span>
<span class="sd">            &#39;a&#39;: append, an existing file is opened for reading and writing,</span>
<span class="sd">            and if the file does not exist it is created.</span>
<span class="sd">            Default to &#39;a&#39;.</span>
<span class="sd">        only_active : bool</span>
<span class="sd">            Keep state values in active cells only. Default to False.</span>
<span class="sd">        reduce_floats : bool</span>
<span class="sd">            if True, float precision will be reduced to np.float32 to save disk space.</span>
<span class="sd">        kwargs : misc</span>
<span class="sd">            Any additional named arguments to component&#39;s ``dump``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : Field</span>
<span class="sd">            Field unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">float_precision</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="k">if</span> <span class="n">reduce_floats</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;rock&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="k">if</span> <span class="n">reduce_floats</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;states&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span> <span class="k">if</span> <span class="n">reduce_floats</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;DATES&#39;</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;DATES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;states&#39;</span><span class="p">:</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">float_dtype</span><span class="o">=</span><span class="n">float_precision</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                          <span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span> <span class="k">if</span> <span class="n">only_active</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">float_dtype</span><span class="o">=</span><span class="n">float_precision</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_dump_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dump model&#39;s data files in tNav project.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dir_path : str</span>
<span class="sd">            Directory where model files will be placed.</span>
<span class="sd">        title : str</span>
<span class="sd">            Model title.</span>
<span class="sd">        kwargs : misc</span>
<span class="sd">            Any additional named arguments that will be substituted to model template file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : Field</span>
<span class="sd">            Field unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dir_inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;INCLUDE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_inc</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir_inc</span><span class="p">)</span>
        <span class="n">datafile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;.data&#39;</span><span class="p">)</span>

        <span class="n">model_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;MODEL_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">DEFAULT_TN_MODEL</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;ECL&#39;</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">DEFAULT_ECL_MODEL</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown model type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_type</span><span class="p">))</span>

        <span class="n">fill_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;UNITS&#39;</span><span class="p">]}</span>
        <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;phases&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;FLUIDS&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;START&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
            <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">]</span>

        <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_dates</span><span class="p">)</span>

        <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;dimens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">):</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">grid_specs</span><span class="o">=</span><span class="n">ORTHOGONAL_GRID</span><span class="p">))</span>
            <span class="n">fill_values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">mapaxes</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">mapaxes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span>
                <span class="n">dx</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dx</span><span class="p">),</span>
                <span class="n">dy</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dy</span><span class="p">),</span>
                <span class="n">dz</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dz</span><span class="p">),</span>
                <span class="n">tops</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">tops</span><span class="p">)</span>
            <span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">CornerPointGrid</span><span class="p">):</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">grid_specs</span><span class="o">=</span><span class="n">CORNERPOINT_GRID</span><span class="p">))</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;coord.inc&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">coord</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="s1">&#39;COORD&#39;</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">zcorn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;zcorn.inc&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">zcorn</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="s1">&#39;ZCORN&#39;</span><span class="p">)</span>
            <span class="n">fill_values</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;coord&#39;</span><span class="p">:</span> <span class="n">coord</span><span class="p">,</span> <span class="s1">&#39;zcorn&#39;</span><span class="p">:</span> <span class="n">zcorn</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Dump for grid of type </span><span class="si">{}</span><span class="s2"> is not implemented.&quot;</span>
                                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="n">inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;actnum.inc&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">inc</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="s1">&#39;ACTNUM&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;actnum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot;INCLUDE</span><span class="se">\n</span><span class="s2">&#39;$</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.inc&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">inc</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">fill_values</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">rock</span><span class="o">=</span><span class="n">tmp</span><span class="p">))</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;aquifers&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot;INCLUDE</span><span class="se">\n</span><span class="s2">&#39;$</span><span class="si">{}</span><span class="s2"> &#39;/</span><span class="se">\n</span><span class="s2">/</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;aquifers_file&#39;</span><span class="p">)</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="s1">&#39;aquifers.inc&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aquifers</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">inc</span><span class="p">))</span>
            <span class="n">fill_values</span><span class="p">[</span><span class="s1">&#39;aquifers_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">aquifers</span><span class="o">=</span><span class="n">tmp</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;TN&#39;</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;welltrack&#39;</span><span class="p">,</span> <span class="s1">&#39;perf&#39;</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;ECL&#39;</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gruptree&#39;</span><span class="p">,</span> <span class="s1">&#39;schedule&#39;</span><span class="p">,</span> <span class="s1">&#39;welspecs&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="n">attr</span> <span class="o">+</span> <span class="s1">&#39;.inc&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">inc</span><span class="p">),</span> <span class="n">attr</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span>
                            <span class="n">dates</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result_dates</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
            <span class="n">fill_values</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;states&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot;INCLUDE</span><span class="se">\n</span><span class="s2">&#39;$</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.inc&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">inc</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attr</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fill_values</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="n">tmp</span><span class="p">))</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;tables&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">+=</span> <span class="s2">&quot;INCLUDE</span><span class="se">\n</span><span class="s2">&#39;$</span><span class="si">{}</span><span class="s2">&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">inc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;.inc&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">inc</span><span class="p">),</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attr</span><span class="p">)</span>
                <span class="n">fill_values</span><span class="p">[</span><span class="n">attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="n">tmp</span><span class="p">))</span>

        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">fill_values</span><span class="p">))</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">safe_substitute</span><span class="p">()</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="n">Template</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Dump missed values for </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">]))</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_dump_binary_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dump model&#39;s binary result files in tNav project.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dir_path : str</span>
<span class="sd">            Path to location where RESULTS directory will be created.</span>
<span class="sd">        title : str</span>
<span class="sd">            Model title.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        out : Field</span>
<span class="sd">            Field unchanged.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dir_res</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;RESULTS&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_res</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir_res</span><span class="p">)</span>

        <span class="n">grid_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span>
        <span class="n">time_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">n_timesteps</span>

        <span class="n">dir_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_res</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

        <span class="n">units_type</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;METRIC&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;FIELD&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;LAB&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;PVT-M&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;UNITS&#39;</span><span class="p">]]</span>

        <span class="n">grid_type</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CornerPointGrid&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;OrthogonalUniformGrid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">class_name</span><span class="p">]</span>

        <span class="n">grid_format</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;CornerPointGrid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;OrthogonalUniformGrid&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">class_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="c1"># 0 - Unknown; 1 - Corner point; 2 - Block centered</span>

        <span class="n">i_phase</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;FLUIDS&#39;</span><span class="p">]:</span>
            <span class="n">i_phase</span> <span class="o">+=</span> <span class="p">{</span><span class="s1">&#39;OIL&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;WATER&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;GAS&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">egrid</span><span class="o">.</span><span class="n">save_egrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">as_corner_point</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">grid_dim</span><span class="p">,</span> <span class="n">grid_format</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">init</span><span class="o">.</span><span class="n">save_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">grid_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                       <span class="n">units_type</span><span class="p">,</span> <span class="n">grid_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">i_phase</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">is_unified</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">restart</span><span class="o">.</span><span class="n">save_restart</span><span class="p">(</span><span class="n">is_unified</span><span class="p">,</span>
                             <span class="n">dir_name</span><span class="p">,</span>
                             <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;PRESSURE&#39;</span><span class="p">,</span>
                                                   <span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">as_corner_point</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span>
                                                   <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;SGAS&#39;</span><span class="p">,</span>
                                                   <span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">as_corner_point</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span>
                                                   <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;SOIL&#39;</span><span class="p">,</span>
                                                   <span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">as_corner_point</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span>
                                                   <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;SWAT&#39;</span><span class="p">,</span>
                                                   <span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">as_corner_point</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span>
                                                   <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">strip_na</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;RS&#39;</span><span class="p">,</span>
                                                   <span class="n">actnum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">as_corner_point</span><span class="o">.</span><span class="n">actnum</span><span class="p">,</span>
                                                   <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">result_dates</span><span class="p">,</span>
                             <span class="n">grid_dim</span><span class="p">,</span>
                             <span class="n">time_size</span><span class="p">,</span>
                             <span class="n">mode</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="n">rates</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">main_branches</span><span class="p">:</span>
            <span class="n">curr_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">.</span><span class="n">total_rates</span>
            <span class="n">rates</span><span class="p">[</span><span class="n">well</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WWPR&#39;</span><span class="p">,</span> <span class="s1">&#39;WOPR&#39;</span><span class="p">,</span> <span class="s1">&#39;WGPR&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">curr_rates</span><span class="p">:</span>
                    <span class="n">rates</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">curr_rates</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>

        <span class="n">summary</span><span class="o">.</span><span class="n">save_summary</span><span class="p">(</span><span class="n">is_unified</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">,</span> <span class="n">rates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_dates</span><span class="p">,</span>
                             <span class="n">grid_dim</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="Field.calculate_rates"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.calculate_rates">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wellnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cf_aggregation</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate oil/water/gas rates for each well segment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        wellnames : list of str</span>
<span class="sd">            Wellnames for rates calculation. If None, all wells are included. Default to None.</span>
<span class="sd">        cf_aggregation: str, &#39;sum&#39; or &#39;eucl&#39;</span>
<span class="sd">            The way of aggregating cf projection (&#39;sum&#39; - sum, &#39;eucl&#39; - Euclid norm).</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rates : pd.DataFrame</span>
<span class="sd">            pd.Dataframe filled with production rates for each phase.</span>
<span class="sd">        block_rates : pd.DataFrame of ndarrays</span>
<span class="sd">            pd.Dataframe filled with arrays of production rates in each grid block.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_dates</span>
        <span class="k">if</span> <span class="n">wellnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wellnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">names</span>
        <span class="k">if</span> <span class="n">multiprocessing</span><span class="p">:</span>
            <span class="n">calc_rates_multiprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timesteps</span><span class="p">,</span> <span class="n">wellnames</span><span class="p">,</span> <span class="n">cf_aggregation</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">calc_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timesteps</span><span class="p">,</span> <span class="n">wellnames</span><span class="p">,</span> <span class="n">cf_aggregation</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Field.history_to_results"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.history_to_results">[docs]</a>    <span class="k">def</span> <span class="nf">history_to_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert history to results.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_main_branch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;history&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">):</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>

        <span class="n">rename</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;QOIL&#39;</span><span class="p">:</span> <span class="s1">&#39;WOPR&#39;</span><span class="p">,</span> <span class="s1">&#39;QGAS&#39;</span><span class="p">:</span> <span class="s1">&#39;WGPR&#39;</span><span class="p">,</span> <span class="s1">&#39;QWAT&#39;</span><span class="p">:</span> <span class="s1">&#39;WWPR&#39;</span><span class="p">,</span> <span class="s1">&#39;QWIN&#39;</span><span class="p">:</span> <span class="s1">&#39;WWIR&#39;</span><span class="p">,</span> <span class="s1">&#39;BHP&#39;</span><span class="p">:</span> <span class="s1">&#39;WBHP&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_main_branch</span><span class="p">:</span>
                <span class="n">new_results</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename</span><span class="p">)[[</span><span class="s1">&#39;DATE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">rename</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
                <span class="n">node</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">new_results</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;DATE&#39;</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># pylint: disable=protected-access</span>
    <span class="k">def</span> <span class="nf">_create_pyvista_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates pyvista grid object with attributes.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UniformGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_vtk_grid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">CornerPointGrid</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_vtk_grid</span><span class="p">)</span>

        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">active_cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">actnum</span> <span class="k">if</span> <span class="s1">&#39;ACTNUM&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">dimens</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">make_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_vtk_grid_params</span><span class="p">[</span><span class="s1">&#39;use_only_active&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">active_cells</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">new_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">new_data</span><span class="p">[</span><span class="o">~</span><span class="n">active_cells</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">new_data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;ACTNUM&#39;</span><span class="p">:</span> <span class="n">make_data</span><span class="p">(</span><span class="n">active_cells</span><span class="p">)})</span>

        <span class="k">if</span> <span class="s1">&#39;rock&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">attr</span><span class="p">:</span> <span class="n">make_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rock</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="k">if</span> <span class="s1">&#39;states&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">sequence</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">attributes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span> <span class="n">make_data</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">snapshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sequence</span><span class="p">)})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_welltracks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotter</span><span class="p">,</span> <span class="n">add_mesh_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds all welltracks to the plot.&quot;&quot;&quot;</span>
        <span class="n">well_tracks</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">welltrack</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                       <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span> <span class="k">if</span> <span class="s1">&#39;WELLTRACK&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attributes</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">well_tracks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">value</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span>

        <span class="n">labeled_points</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">):</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">dz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">well_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">well_tracks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">wtrack_idx</span><span class="p">,</span> <span class="n">first_intersection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="p">[</span><span class="n">well_name</span><span class="p">]</span><span class="o">.</span><span class="n">_first_entering_point</span> <span class="c1"># pylint: disable=protected-access</span>
            <span class="k">if</span> <span class="n">first_intersection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">):</span>
                    <span class="n">first_intersection</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">origin</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">first_intersection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">first_intersection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z_min</span><span class="p">]]),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">first_intersection</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">value</span><span class="p">[</span><span class="n">wtrack_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">z_min</span><span class="p">]]),</span> <span class="n">value</span><span class="p">])</span>

            <span class="n">pv_line</span> <span class="o">=</span> <span class="n">lines_from_points</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">add_mesh_kwargs_</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;line_width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">}</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">add_mesh_kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">add_mesh_kwargs_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">add_mesh_kwargs</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">pv_line</span><span class="p">,</span> <span class="o">**</span><span class="n">add_mesh_kwargs_</span><span class="p">)</span>

            <span class="n">labeled_points</span><span class="p">[</span><span class="n">well_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv_line</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">labeled_points</span>

<div class="viewcode-block" id="Field.show"><a class="viewcode-back" href="../../../api/field.html#deepfield.field.Field.show">[docs]</a>    <span class="nd">@state_check</span><span class="p">(</span><span class="k">lambda</span> <span class="n">state</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">spatial</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">thresholding</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">slicing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_only_active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cell_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_wells</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">notebook</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">theme</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">show_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Field visualization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attr: str or None</span>
<span class="sd">            Attribute of the grid to show. If None, ACTNUM will be shown.</span>
<span class="sd">        opacity: float or None</span>
<span class="sd">            Opacity of the visualization. Default is 0.5.</span>
<span class="sd">        thresholding: bool</span>
<span class="sd">            Show slider for thresholding. Cells with attribute value less than</span>
<span class="sd">            threshold will not be shown. Default False.</span>
<span class="sd">        slicing: bool</span>
<span class="sd">            Show by slices. Default False.</span>
<span class="sd">        timestamp: int or None</span>
<span class="sd">            The timestamp to show. Meaningful only for sequential attributes (States).</span>
<span class="sd">            Has no effect given non-sequential attributes.</span>
<span class="sd">        use_only_active: bool</span>
<span class="sd">            Corner point grid creation using only active cells. Default to True.</span>
<span class="sd">        cell_size: int</span>
<span class="sd">            Cell size for orthogonal uniform grid.</span>
<span class="sd">        scaling: bool, list or tuple</span>
<span class="sd">            The ratio of the axes in case of iterable, if True then it&#39;s (1, 1, 1),</span>
<span class="sd">            if False then it is natural. Default True.</span>
<span class="sd">        cmap: object</span>
<span class="sd">            Matplotlib, Colorcet, cmocean, or custom colormap</span>
<span class="sd">        show_wells: bool</span>
<span class="sd">            Show well trajectories. Default True.</span>
<span class="sd">        notebook: bool</span>
<span class="sd">            When True, the resulting plot is placed inline a jupyter notebook.</span>
<span class="sd">            Assumes a jupyter console is active. Automatically enables off_screen.</span>
<span class="sd">        theme: str</span>
<span class="sd">            PyVista theme, e.g. &#39;default&#39;, &#39;night&#39;, &#39;document&#39;.</span>
<span class="sd">            See https://docs.pyvista.org/examples/02-plot/themes.html for more options.</span>
<span class="sd">        show_labels: bool</span>
<span class="sd">            Show x, y, z axis labels. Default True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="s1">&#39;ACTNUM&#39;</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">attr</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">pv</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s2">&quot;viewup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pv</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;camera&quot;</span><span class="p">][</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">]</span>
        <span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;use_only_active&#39;</span><span class="p">:</span> <span class="n">use_only_active</span><span class="p">,</span> <span class="s1">&#39;cell_size&#39;</span><span class="p">:</span> <span class="n">cell_size</span><span class="p">,</span> <span class="s1">&#39;scaling&#39;</span><span class="p">:</span> <span class="n">scaling</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">OrthogonalUniformGrid</span><span class="p">):</span>
            <span class="n">grid_params</span><span class="p">[</span><span class="s1">&#39;use_only_active&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">plot_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;show_edges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;nan_opacity&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">cmap</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">show_wells</span> <span class="ow">and</span> <span class="s1">&#39;wells&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wells</span><span class="o">.</span><span class="n">_get_first_entering_point</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>

        <span class="n">old_vtk_grid_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_vtk_grid_params</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">_vtk_grid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">old_vtk_grid_params</span> <span class="o">!=</span> <span class="n">grid_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">create_vtk_grid</span><span class="p">(</span><span class="o">**</span><span class="n">grid_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">old_vtk_grid_params</span> <span class="o">!=</span> <span class="n">grid_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_pyvista_grid</span><span class="p">()</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyvista_grid</span>

        <span class="n">sequential</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;states&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">)</span>

        <span class="n">pv</span><span class="o">.</span><span class="n">set_plot_theme</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
        <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="n">notebook</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Field&#39;</span><span class="p">)</span>

        <span class="n">opacity_widget</span> <span class="o">=</span> <span class="n">opacity</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">threshold_widget</span> <span class="o">=</span> <span class="n">thresholding</span>
        <span class="n">timestamp_widget</span> <span class="o">=</span> <span class="n">sequential</span> <span class="ow">and</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">slice_xyz_widget</span> <span class="o">=</span> <span class="n">slicing</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">thresholding</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sequential</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{attribute}</span><span class="s2">_</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                                 <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">n_timesteps</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="n">attribute</span><span class="p">])</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asscalar</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">widget_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;plotter&#39;</span><span class="p">:</span> <span class="n">plotter</span><span class="p">,</span>
            <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span>
            <span class="s1">&#39;attribute&#39;</span><span class="p">:</span> <span class="n">attribute</span><span class="p">,</span>
            <span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">opacity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">opacity</span><span class="p">,</span>
            <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="s1">&#39;slice_xyz&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">slicing</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">sequential</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">timestamp</span><span class="p">,</span>
            <span class="s1">&#39;plot_params&#39;</span><span class="p">:</span> <span class="n">plot_params</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">_create_mesh_wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">widget_values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">create_mesh</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">plotter</span> <span class="o">=</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">widget_values</span><span class="p">)</span>

        <span class="n">slider_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;pointa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">),</span> <span class="s1">&#39;pointb&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">)},</span>
            <span class="p">{</span><span class="s1">&#39;pointa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">),</span> <span class="s1">&#39;pointb&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">)},</span>
            <span class="p">{</span><span class="s1">&#39;pointa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.69</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">),</span> <span class="s1">&#39;pointb&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">)},</span>
            <span class="p">{</span><span class="s1">&#39;pointa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">),</span> <span class="s1">&#39;pointb&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.30</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">)},</span>
            <span class="p">{</span><span class="s1">&#39;pointa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">),</span> <span class="s1">&#39;pointb&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">)},</span>
            <span class="p">{</span><span class="s1">&#39;pointa&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.69</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">),</span> <span class="s1">&#39;pointb&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">)},</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">opacity_widget</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">ch_opacity</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span>
                    <span class="n">opacity</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">widget_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;opacity&#39;</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="n">slider_pos</span> <span class="o">=</span> <span class="n">slider_positions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">slider_range</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">ch_opacity</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">slider_range</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Opacity&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">slider_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">threshold_widget</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">ch_threshold</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span>
                    <span class="n">threshold</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">widget_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;threshold&#39;</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="n">slider_pos</span> <span class="o">=</span> <span class="n">slider_positions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sequential</span><span class="p">:</span>
                <span class="n">trange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">n_timesteps</span><span class="p">)</span> <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">timestamp</span><span class="p">]</span>
                <span class="n">min_slider</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{attribute}</span><span class="s2">_</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">])</span>
                <span class="n">max_slider</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{attribute}</span><span class="s2">_</span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">])</span>
                <span class="n">slider_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">min_slider</span><span class="p">,</span> <span class="n">max_slider</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slider_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="n">attribute</span><span class="p">]),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">cell_arrays</span><span class="p">[</span><span class="n">attribute</span><span class="p">])]</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">ch_threshold</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">slider_range</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Threshold&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">slider_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timestamp_widget</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">ch_timestamp</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">widget_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="n">slider_pos</span> <span class="o">=</span> <span class="n">slider_positions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">slider_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">n_timesteps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">ch_timestamp</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">slider_range</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">slider_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">slice_xyz_widget</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">ch_slice_x</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">new_slice_xyz</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">widget_values</span><span class="p">[</span><span class="s1">&#39;slice_xyz&#39;</span><span class="p">])</span>
                <span class="n">new_slice_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">return</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span>
                    <span class="n">slice_xyz</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_slice_xyz</span><span class="p">),</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span>
                                                       <span class="n">widget_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;slice_xyz&#39;</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="k">def</span> <span class="nf">ch_slice_y</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="n">new_slice_xyz</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">widget_values</span><span class="p">[</span><span class="s1">&#39;slice_xyz&#39;</span><span class="p">])</span>
                <span class="n">new_slice_xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                <span class="k">return</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span>
                    <span class="n">slice_xyz</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_slice_xyz</span><span class="p">),</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span>
                                                       <span class="n">widget_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;slice_xyz&#39;</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="k">def</span> <span class="nf">ch_slice_z</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
                <span class="n">new_slice_xyz</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">widget_values</span><span class="p">[</span><span class="s1">&#39;slice_xyz&#39;</span><span class="p">])</span>
                <span class="n">new_slice_xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
                <span class="k">return</span> <span class="n">_create_mesh_wrapper</span><span class="p">(</span>
                    <span class="n">slice_xyz</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">new_slice_xyz</span><span class="p">),</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span>
                                                       <span class="n">widget_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;slice_xyz&#39;</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">,</span> <span class="n">z_pos</span> <span class="o">=</span> <span class="n">slider_positions</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">bounds</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">ch_slice_x</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">x_pos</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">ch_slice_y</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="p">[</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">y_pos</span><span class="p">)</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">add_slider_widget</span><span class="p">(</span><span class="n">ch_slice_z</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="p">[</span><span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">z_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_wells</span> <span class="ow">and</span> <span class="s1">&#39;wells&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
            <span class="n">labeled_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_welltracks</span><span class="p">(</span><span class="n">plotter</span><span class="p">)</span>
            <span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">labeled_points</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="k">def</span> <span class="nf">show_well_name</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">plotter</span><span class="o">.</span><span class="n">add_point_labels</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wells_names&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotter</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="s1">&#39;wells_names&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">notebook</span><span class="p">:</span>
                <span class="n">plotter</span><span class="o">.</span><span class="n">add_checkbox_button_widget</span><span class="p">(</span><span class="n">show_well_name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s2">&quot;      Wells&#39; names&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">),</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

        <span class="n">scaling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">scaling</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">scales</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">scales</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaling</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">plotter</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="o">*</span><span class="n">scaling</span><span class="p">)</span>

        <span class="n">plotter</span><span class="o">.</span><span class="n">show_grid</span><span class="p">(</span><span class="n">show_xlabels</span><span class="o">=</span><span class="n">show_labels</span><span class="p">,</span> <span class="n">show_ylabels</span><span class="o">=</span><span class="n">show_labels</span><span class="p">,</span> <span class="n">show_zlabels</span><span class="o">=</span><span class="n">show_labels</span><span class="p">)</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>


<span class="k">def</span> <span class="nf">create_mesh</span><span class="p">(</span><span class="n">plotter</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">opacity</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">slice_xyz</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">plot_params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create mesh for pyvista visualisation.&quot;&quot;&quot;</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">remove_actor</span><span class="p">(</span><span class="s1">&#39;actor&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">remove_scalar_bar</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">slice_xyz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">slice_orthogonal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">slice_xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">slice_xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">slice_xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">plot_params</span><span class="p">[</span><span class="s1">&#39;scalar_bar_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">label_font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">position_y</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">position_x</span><span class="o">=</span><span class="mf">0.45</span><span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;actor&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span> <span class="n">stitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;upper_edge&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotter</span><span class="o">.</span><span class="n">add_text</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, t=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;upper_edge&#39;</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plotter</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Skoltech-CHR

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>